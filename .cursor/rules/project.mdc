---
alwaysApply: true
---

# Lunar Descent Project Context

A modern, high-fidelity Lunar Lander game for Apple Vision Pro, played inside a full-scale cockpit, featuring hard-arcade Newtonian-style physics, a hyper-real cinematic Moon, spatial audio, and an instant-retry leaderboard loop optimized for 2–3 minute runs.

## Project Summary

**One-liner**: A modern, high-fidelity Lunar Lander game for Apple Vision Pro, played inside a full-scale cockpit, featuring hard-arcade Newtonian-style physics, a hyper-real cinematic Moon, spatial audio, and an instant-retry leaderboard loop optimized for 2–3 minute runs.

**Player fantasy**: "I'm inside a lunar lander, fighting gravity with precision. The Moon outside is breathtaking. Every landing is tense, and every run teaches me something."

**Platform**: Apple Vision Pro (visionOS)

**Engine**: RealityKit-first with procedural meshes + Reality Composer Pro ShaderGraph materials

## Core Experience Pillars

1. **Cockpit presence**
   - The cockpit is the "home." It grounds the user.
   - Player can lean and small room-scale movements are supported.
   - Cockpit is 1:1 scale and physically believable.

2. **Exterior beauty**
   - The Moon surface, lighting, shadows, and sky are visually compelling.
   - Players frequently stop to look out the windows.
   - Hyper-real cinematic lunar aesthetic.

3. **Readable danger**
   - The game is brutal—but fair.
   - Errors are legible through motion, instruments, and audio warnings.
   - Landing is challenging but learnable.

4. **Fast loop**
   - Crash → replay → restart feels frictionless.
   - Results are immediate and motivating.
   - Runs are 2–3 minutes with instant restart.

## Architecture Overview

### Key Modules

- **App**: Entry point, window management, immersive space lifecycle
  - `AppMain.swift`, `ContentView.swift`, `ImmersiveGameView.swift`

- **Game**: Core game systems
  - `GameRoot.swift`: Scene hierarchy root (worldRoot + cockpitRoot)
  - `GameState/`: Game state machine, config, run controller, metrics, scoring, leaderboard
  - `Terrain/`: Procedural terrain generation, chunks, LOD, materials, rocks
  - `Physics/`: Rigid body simulation, thrusters, fuel, landing evaluation
  - `Input/`: Joystick gesture handling, control state, input filtering
  - `Replay/`: Replay recording, camera controller, cinematic presets, effects
  - `Audio/`: Spatial audio manager, engine audio, warning system
  - `Debug/`: Debug HUD, menu, signposts, release flags
  - `UI/`: Results panel, in-world UI attachments
  - `Sky/`: Sky dome, sun lighting, Earth body
  - `Cockpit/`: Cockpit blockout, comfort rules, joystick placement, loader
  - `ECS/`: Tick system, components, frame mapping

### Scene Hierarchy

- `rootEntity`: Top-level entity
  - `worldRoot`: Terrain, sky, external objects (moves during gameplay)
  - `cockpitRoot`: Interior cockpit geometry, joysticks, UI attachments (fixed in real space during gameplay)

## Runtime Rules

- **Units**: 1 world unit = 1 meter everywhere
- **Terrain**: Single source of truth - `TerrainHeightModel` drives BOTH rendering and physics queries
- **Physics**: Use a fixed-timestep simulation loop (accumulator pattern)
- **Performance**: Avoid per-frame allocations in hot loops (terrain updates, physics step)
- **Comfort**: Keep player comfort - no forced camera motion during gameplay; only head movement

## Units Convention

- **Length**: meters
- **Time**: seconds
- **Mass**: kilograms
- **Angles**: radians internally; degrees only for UI/debug

## Non-Goals (v1)

These are explicitly out of scope for v1:

- No open-world exploration
- No story/campaign
- No multiplayer
- No tutorial/hand-holding onboarding
- No complex meta progression (unlock trees, upgrades)
- No alternative input systems ("Plan B") in v1
- No true full-Moon spherical traversal system (v1 uses local terrain approach)

## Key Technical Decisions

- **Terrain**: Local procedural heightfield + horizon illusion (not spherical planet)
- **Physics**: Hard-arcade rigid body (forces + torque), deterministic
- **Input**: Two-handed virtual joysticks in cockpit (room-scale only, no artificial locomotion)
- **Scoring**: Fuel efficiency is primary score driver
- **Rendering**: RealityKit procedural meshes + ShaderGraph materials (v1)
- **Audio**: Spatial audio is a pillar - engine/thrust, structural creaks, warnings

## Reference Documents

- **Product Requirements**: `Tickets/PRD.md` - Complete product requirements document
- **Tickets**: `Tickets/TODO/` (pending) and `Tickets/DONE/` (completed) - Implementation tickets organized by EPIC

## Development Workflow

This project uses a ticket-based workflow. See `.cursor/rules/tickets.mdc` for ticket workflow rules.

## Success Metrics

- Median run length: ~2–3 minutes
- High "one more try" factor (attempts per session)
- Near-instant restart latency
- Stable frame pacing
- Low crash rate
