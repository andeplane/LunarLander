---
alwaysApply: true
---

# Lunar Explorer Project Context

A browser-based Moon exploration experience built with TypeScript and Three.js, featuring procedural terrain generation with LOD-based chunk streaming, delivering a visually compelling lunar surface you can fly over freely.

## Project Summary

**One-liner**: A browser-based Moon exploration experience built with TypeScript and Three.js, featuring procedural terrain generation with LOD-based chunk streaming.

**Player fantasy**: "I'm soaring over the Moon's surface, watching craters and ridges stretch to the horizon. The terrain is vast and seamless—I can fly anywhere."

**Platform**: Web Browser (Desktop)

**Tech Stack**: TypeScript, Three.js, Vite

## Core Experience Pillars

1. **Beautiful procedural terrain**
   - Realistic heightfield-based terrain with craters, ridges, and surface detail
   - Visually compelling from high altitude down to near-surface
   - Hyper-real cinematic lunar aesthetic

2. **High-performance chunk system**
   - Seamless infinite terrain feel
   - Distance-based LOD with smooth transitions
   - Stable 60fps on mid-range hardware

3. **Technical showcase**
   - Clean, well-architected TypeScript codebase
   - Modern Three.js terrain techniques
   - Foundation for future features (VR, landing mechanics)

## Architecture Overview

### Key Modules

- **Core**: Engine setup, main loop, input handling
  - `Engine.ts`: Main loop, renderer setup
  - `InputManager.ts`: Keyboard/mouse handling

- **Terrain**: Procedural terrain generation and management
  - `ChunkManager.ts`: Chunk lifecycle management
  - `Chunk.ts`: Individual chunk mesh + data
  - `LODController.ts`: Distance-based LOD decisions
  - `HeightGenerator.ts`: Noise-based terrain generation
  - `TerrainMaterial.ts`: Lunar surface shader/material
  - `MoonSurface.ts`: Lunar surface details like craters

- **Camera**: Flight controls
  - `FlightController.ts`: Free-flight camera controls

- **Environment**: Sky and lighting
  - `Skybox.ts`: Starfield background
  - `Lighting.ts`: Sun directional light + shadows

- **Utils**: Shared utilities
  - `noise.ts`: Simplex/Perlin noise utilities
  - `math.ts`: Vector/math helpers

### Project Structure

```
src/
├── main.ts                 # Entry point, scene setup
├── core/
│   ├── Engine.ts
│   └── InputManager.ts
├── terrain/
│   ├── ChunkManager.ts
│   ├── Chunk.ts
│   ├── LODController.ts
│   ├── HeightGenerator.ts
│   └── TerrainMaterial.ts
│   └── MoonSurface.ts
├── camera/
│   └── FlightController.ts
├── environment/
│   ├── Skybox.ts
│   └── Lighting.ts
├── utils/
│   ├── noise.ts
│   └── math.ts
└── types/
    └── index.ts
```

## Runtime Rules

- **Units**: 1 world unit = 1 meter everywhere
- **Terrain**: Single source of truth - `HeightGenerator` drives BOTH rendering and height queries (will call functions in MoonSurface.ts)
- **Performance**: Avoid per-frame allocations in hot loops (chunk updates, rendering)
- **Chunks**: Generate mesh data off main thread where possible

## Units Convention

- **Length**: meters
- **Time**: seconds
- **Angles**: radians internally; degrees only for UI/debug

## Non-Goals (v1)

These are explicitly out of scope for v1:

- No VR/WebXR support (future consideration)
- No landing mechanics or physics simulation
- No scoring, leaderboards, or game loop
- No collision detection with terrain
- No multiplayer
- No mobile support (desktop-first)

## Key Technical Decisions

- **Terrain**: Local procedural heightfield with chunk streaming (not spherical planet)
- **LOD**: 4 levels based on distance (256x256 down to 16x16 vertices per chunk)
- **Noise**: Multi-octave fractal noise and crater stamps
- **Rendering**: Three.js with PBR materials and cascaded shadow maps
- **Controls**: Keyboard/mouse 6DOF flight camera
- **Build**: Vite for dev server and bundling

## Dependencies

| Package | Purpose |
|---------|---------|
| `three` | 3D rendering engine |
| `simplex-noise` | Procedural noise generation |
| `typescript` | Type-safe development |
| `vite` | Dev server and bundler |

## Reference Documents

- **Product Requirements**: `docs/PRD.md` - Complete product requirements document

## Performance Targets

| Metric | Target |
|--------|--------|
| Frame rate | 60fps stable |
| Frame time | <16.6ms |
| Draw calls | <500 per frame |
| Triangle count | <2M visible |
| Memory | <1GB GPU, <500MB JS heap |
| Chunk build time | <50ms per chunk |

## Success Metrics

- Stable 60fps during flight at various altitudes
- Chunk loading/unloading without visible hitches
- Seamless LOD transitions (no popping artifacts)
- Memory usage remains bounded during extended sessions
