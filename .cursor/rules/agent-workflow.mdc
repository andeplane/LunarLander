---
alwaysApply: true
---

# Agent Implementation Workflow

When working on tickets, follow this workflow to ensure quality and correctness.

## Before Starting Work

1. **Read the entire ticket file** from `Tickets/TODO/EPIC-XX/`
   - Understand the "Why" and "Goal" sections
   - Review all dependencies listed in the ticket
   - Check if dependencies are complete before starting

2. **Ask clarifying questions** if anything is unclear:
   - Ambiguous requirements or acceptance criteria
   - Unclear technical approach or constraints
   - Missing context about existing code or systems
   - Conflicting information between ticket and codebase

   **Do not proceed with implementation if critical questions remain unanswered.**

## Implementation Phase

3. **Follow the ticket's Steps section** in order
   - Create/modify files as specified in "Files to Create" and "Files to Modify"
   - Implement according to the ticket's goal and acceptance criteria
   - Keep changes focused on the ticket scope (no unrelated refactoring)

4. **Ensure code quality**:
   - Follow project conventions and architecture patterns
   - Maintain single source of truth principles (e.g., TerrainHeightModel)
   - Avoid per-frame allocations in hot loops
   - Use appropriate units (meters, seconds, radians internally)

## Verification Phase

5. **Build the project** to verify it compiles:
   - Run `xcodebuild` or build in Xcode
   - Fix any compilation errors before considering the ticket complete
   - Ensure the project builds for visionOS target

6. **Verify functionality**:
   - Check that the feature works as described in the ticket
   - Ensure there is visible or logged proof the feature works
   - Verify integration (not a detached demo) unless explicitly stated otherwise

7. **Check acceptance criteria**:
   - Review each acceptance criterion in the ticket
   - Ensure all criteria are met before marking as complete

## Before Completion

8. **Complete the manual test plan**:
   - Follow the test steps listed in the ticket
   - Document any issues found during testing
   - Fix issues before moving ticket to DONE

9. **Final checks**:
   - No TODOs in main code path (allowed only behind debug flags)
   - No obvious regressions introduced
   - Code follows project standards

## Communication

- If you encounter blockers or need clarification, ask questions early
- If implementation reveals issues with the ticket approach, discuss alternatives
- Document any deviations from the ticket (with rationale) if necessary
